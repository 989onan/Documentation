= Upgrading from SML 3.4.x to 3.5

== Update your Starter Project

First, read the special notes about this update below.

After you have finished reading them,
follow the directions on the
xref:Development/UpdatingToNewVersions.adoc[Updating your Mod]
guide to install the updated engine, starter project, and update your mod.

[IMPORTANT]
====
Remember to keep the old engine installed and a working copy of your previous starter project around
until you are certain you don't need them anymore!
====

== Required Changes

In addition to any specific-to-your-mod issues you may encounter,
the changes described below _must_ be made in order for your mod to be updated.

=== Obtain the New Engine (Special Directions!)

We have moved our fork of Unreal Engine to be inside the Satisfactory Modding organization
instead of being owned by a separate github user.
As such, the URL for downloading the engine has changed
as well as the means of accessing it.

More information can be found
xref:Development/BeginnersGuide/dependencies.adoc#UnrealLinker[here].

=== Switch to Visual Studio 2022

Unreal Engine 5 no longer supports Visual Studio 2019,
nor the 2017 or 2019 toolchains.

You can find information on installing Visual Studio on the
xref:Development/BeginnersGuide/dependencies.adoc#_visual_studio[Dependencies page].

=== Install New Visual Studio Component

Even if you already have Visual Studio 2022 installed,
you'll need to modify your installation via the installer to add a new MSVC build tools component.
See the xref:Development/BeginnersGuide/dependencies.adoc#_visual_studio[Dependencies page]
for more information.

=== Rider users: Mods no longer detected 

The structure of the project has changed and Rider can no longer auto discover mod targets.
You can still edit {cpp} files as usual, though.

=== Folder Move: Plugins to Mods

Instead of being placed in the `Plugins/` folder, mod folders are now located in the project's `Mods/` folder.
Why the change?

- Real™️ Official™️ mods will be in the Mods folder instead of Plugins, when they eventually™️ come out. This move is just preparation for that well in advance
- It keeps base-game plugins (Wwise, AbstractInstance) clearly separate from mods
- Alpakit was already remapping mods from the Plugins folder to Mods behind the scenes in the past anyways

==== What you have to do:

1. Move your own mod folders from `<Starter_Project_Folder>\Plugins` to `<Starter_Project_Folder>\Mods`

* SML 3.4.x Locations:
  image:BeginnersGuide/SML_Plugins.png[SML 3.4.x, align="center"]

* SML 3.5.x Locations:
  image:BeginnersGuide/SML_Mods.png[SML 3.5.x, align="center"]

2. link:BeginnersGuide\project_setup.adoc#_project_compilation[Compile your project like normal]

This change also affects the game client -
mods are now placed in the `<SF_Install>\FactoryGame\Mods` folder!
Alpakit's "copy mods" feature has already been updated to account for this.

=== Unreal Engine 5 new Keybinds system

Unreal Engine 5 has overhauled how user input and key bindings are handled.
If your mod made use of keybindings, they will stop working,
and possibly prevent your mod from compiling,
until you change to the new system.

TODO directions on how to use this

=== Increased Access Transformer Specificity

If you are using BlueprintReadWrite or BlueprintCallable access transformers
you will have to update their Class field to use their runtime class path.
This means adding the prefix `/Script/FactoryGame.` to the class name
and removing any Unreal prefixes like `A` or `U`.

For example, if you were previously using the access transformer:

[source,ini]
----
[AccessTransformers]
BlueprintReadWrite=(Class="AFGWireHologram", Property="mDefaultPowerPoleRecipe")
----

You will have to switch to:

[source,ini]
----
[AccessTransformers]
BlueprintReadWrite=(Class="/Script/FactoryGame.FGWireHologram", Property="mDefaultPowerPoleRecipe")
----

This is done as part of a move away from using ANY_PACKAGE,
which you can read more about in the Unreal documentation if you are interested.

=== {cpp} Mod Module Build.cs Format Changes

When generating visual studio project files for your project, you may encounter an error similar to the below:

// cspell:ignore projectfiles
```
Running C:/Program Files/Unreal Engine - CSS U8/Engine/Build/BatchFiles/Build.bat  -projectfiles -project="C:/Git/SatisfactoryModLoader/FactoryGame.uproject" -game -rocket -progress -log="C:\Git\SatisfactoryModLoader/Saved/Logs/UnrealVersionSelector-2023.07.08-13.29.57.log"
Running UnrealBuildTool: dotnet "..\..\Engine\Binaries\DotNET\UnrealBuildTool\UnrealBuildTool.dll" -projectfiles -project="C:/Git/SatisfactoryModLoader/FactoryGame.uproject" -game -rocket -progress -log="C:\Git\SatisfactoryModLoader/Saved/Logs/UnrealVersionSelector-2023.07.08-13.29.57.log"
Log file: C:\Git\SatisfactoryModLoader\Saved\Logs\UnrealVersionSelector-2023.07.08-13.29.57.log
Log file: C:\Users\Rob\AppData\Local\UnrealBuildTool\Log_GPF.txt

Some Platforms were skipped due to invalid SDK setup: Linux, LinuxArm64.
See the log file for detailed information

Discovering modules, targets and source code for project...
C:\Git\SatisfactoryModLoader\Mods\MAMTips\Source\MAMTips\MAMTips.Build.cs(5,7): error CS0246: The type or namespace name 'Tools' could not be found (are you missing a using directive or an assembly reference?)
C:\Git\SatisfactoryModLoader\Mods\MAMTips\Source\MAMTips\MAMTips.Build.cs(13,32): error CS0246: The type or namespace name 'DirectoryReference' could not be found (are you missing a using directive or an assembly reference?)
C:\Git\SatisfactoryModLoader\Mods\MAMTips\Source\MAMTips\MAMTips.Build.cs(14,64): error CS0246: The type or namespace name 'DirectoryReference' could not be found (are you missing a using directive or an assembly reference?)
Expecting to find a type to be declared in a target rules named 'FactoryEditorTarget'.  This type must derive from the 'TargetRules' type defined by Unreal Build Tool.
```

Unreal Engine 5 includes updates to UBT to make it more extensible.
You may have to add additional `using` directives to your mod module's Build.cs file.
In the case of this example error message, adding the following directives resolved the issue.

[source,cs]
----
using System;
using System.Runtime.InteropServices;
using System.Text;
using EpicGames.Core;
----

== Notable New Features

Numerous new features have been introduced in SML3.5 which you may wish to switch your mod over to using
or implement as part of a future update to your mod.

=== Research Tree Editor

Have you been holding off on implementing a MAM research tree in your mod because of how tedious it is?
Wait no more!

The new Research Tree Editor allows you to create and edit research trees in a visual interface
and provides basic error checking functionality.

To launch the tool, navigate to the `SMLEditor Content/ResearchTree/` folder in the Content Browser,
right click on the `ResearchTreeHelper` asset, then select `Run Editor Utility Widget`.
Hover over elements in the tool to see tooltips explaining what they do.

The Example Mod has been updated with a complex research tree (created by the tool)
to demonstrate and explain some important research tree concepts.
Explore this tree, and the base game's trees, to learn more about how research trees work.

=== ExampleMod Multiplayer Examples

ExampleMod has been updated to include some examples of correctly adding multiplayer functionality to your mod.
The xref:Development/Satisfactory/Multiplayer.adoc[Multiplayer]
page has also been updated with more information and tutorials.

=== Session Settings

Session Settings are a feature similar to the base game's Advanced Game Settings that allows mods to store configuration information on a per-game-save basis.

Read more about it on the
xref:Development/ModLoader/SessionSettings.adoc[Session Settings] page.

=== Widget Blueprint Hooks

Widget Blueprint Hooks can be used to add your custom widget into one of the existing game widgets.
If you've previously been using `Bind on BPFunction` 'Construct', this system may be a better fit for you.

Read more about it on the
xref:Development/ModLoader/WidgetBlueprintHooks.adoc[Widget Blueprint Hooks] page.

See the Example Mod and SML itself for examples of how to use this system.

=== Simple Construction Script Hooks

Blueprint Simple Construction Script hooks allow adding modded
https://docs.unrealengine.com/5.1/en-US/components-in-unreal-engine/[Components]
to any blueprint-based actor.

Read more about it on the
xref:Development/ModLoader/SimpleConstructionScript.adoc[Simple Construction Script (SCS) Hooks] page.

See the Example Mod for examples of how to use this system.

=== Mod Localization

We have started hosting our own Tolgee instance
that makes it easy to crowdsource and contribute translations to the modding toolkit and to mods.

Read more about how you can get started on the
xref:Development/Localization.adoc[Localizing Mods] page.

=== Custom Level Support

This feature has not yet been documented in detail, however,
the Example Mod has been updated with its own custom level that
properly registers itself through the Custom Level system and demonstrates many custom level concepts.
