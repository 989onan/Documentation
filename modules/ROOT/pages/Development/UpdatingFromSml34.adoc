= Upgrading from SML 3.4.x to 3.5

[IMPORTANT]
====
The contents of this page will change frequently!
Keep your eyes on the `#modding-info-feed` discord channel to be notified when updates are made.
====

SML3.5 brings support for Unreal Engine 5 and a number of new game systems.

== Update your Starter Project

First, please read this entire page before you begin updating your mod.
It will save you time later to have an idea going in of what to expect while updating.

After you have finished reading this page,
follow the directions on the
xref:Development/UpdatingToNewVersions.adoc[Updating your Mod]
guide to install the updated engine, starter project, and update your mod.

If Update 8 has not yet been released on Early Access when you are reading this guide,
make sure to grab the `dev` branch of the Starter Project instead of `master`.

[IMPORTANT]
====
Remember to keep the old engine installed and a working copy of your previous starter project around
until you are certain you don't need them anymore!
====

== Not Done Yet

The following features are not ready to use yet.
This section will change often!

=== UE Linker still having some bugs ironed out

You might run into troubles accessing the new Unreal Engine repo.
Please contact us on the Discord if you get stuck.

=== SMLEditor Generate Config Structs

The SMLEditor utility to generate config structs from mod configurations
does not correctly appear in the scripted asset actions menu.

=== Sort Array Node

The sort array node is not currently working correctly.

=== Plugin Translation Targets

The new mod translation system is not totally ready for use.
It is functioning, and you don't have to use the workaround for adding game translation targets at runtime,
but the editor does not save data properly and it will be wiped upon closing the editor.
You can still use the system and package mods with translations,
but you'll have to re-set up the target
and re-import the translated strings every time you restart the editor.

== Required Changes

In addition to any specific-to-your-mod issues you may encounter,
the changes described below _must_ be made in order for your mod to be updated.

=== Obtain the New Engine (Special Directions!)

We have moved our fork of Unreal Engine to be inside the Satisfactory Modding organization
instead of being owned by a separate github user.
As such, the URL for downloading the engine has changed
as well as the means of accessing it.

More information can be found
xref:Development/BeginnersGuide/dependencies.adoc#UnrealLinker[here].

=== Re-Enable Show Plugin Content

Your saved editor setting for the UE4 option "Show Plugin Content" in Content Browsers does not carry over to UE5.
You'll have to turn it back on again.

image:BeginnersGuide/simpleMod/ShowPluginContentInViewer.png[Show Plugin Content in Viewer]

=== Switch to Visual Studio 2022

Although Unreal Engine 5 still supports some previous versions of Visual Studio,
they have not been tested by the community and we are not supporting them.
You should switch to Visual Studio 2022, and the 2022 toolchain,
to avoid any potential issues.

You can find information on installing Visual Studio on the
xref:Development/BeginnersGuide/dependencies.adoc#_visual_studio[Dependencies page].

=== Install New Visual Studio Component

Even if you already have Visual Studio 2022 installed,
you'll need to modify your installation via the installer to add a new MSVC build tools component.
See the xref:Development/BeginnersGuide/dependencies.adoc#_visual_studio[Dependencies page]
for more information.

=== Folder Move: Plugins to Mods

Instead of being placed in the `Plugins/` folder, mod folders are now located in the project's `Mods/` folder.
Why the change?

- Real™️ Official™️ mods will be in the Mods folder instead of Plugins, when they eventually™️ come out. This move is just preparation for that well in advance
- It keeps base-game plugins (Wwise, AbstractInstance) clearly separate from mods
- Alpakit was already remapping mods from the Plugins folder to Mods behind the scenes in the past anyways

==== What you have to do:

1. Move your own mod folders from `<Starter_Project_Folder>\Plugins` to `<Starter_Project_Folder>\Mods`

* SML 3.4.x Locations:
  image:BeginnersGuide/SML_Plugins.png[SML 3.4.x, align="center"]

* SML 3.5.x Locations:
  image:BeginnersGuide/SML_Mods.png[SML 3.5.x, align="center"]

2. link:BeginnersGuide\project_setup.adoc#_project_compilation[Compile your project like normal]

This change also affects the game client -
mods are now placed in the `<SF_Install>\FactoryGame\Mods` folder!
Alpakit's "copy mods" feature has already been updated to account for this.

=== Unreal Engine 5 new Keybinds system

Unreal Engine 5 has overhauled how user input and key bindings are handled.
If your mod made use of keybindings, they will stop working,
and the dead code will possibly prevent your mod from compiling,
until you change to the new system.

More info can be found on the
xref:Development/Satisfactory/EnhancedInputSystem.adoc[Enhanced Input System] page.


=== Increased Access Transformer Specificity

If you are using BlueprintReadWrite or BlueprintCallable access transformers
you will have to update their Class field to use their runtime class path.
This means adding the prefix `/Script/FactoryGame.` to the class name
and removing any Unreal prefixes like `A` or `U`.

For example, if you were previously using the access transformer:

[source,ini]
----
[AccessTransformers]
BlueprintReadWrite=(Class="AFGWireHologram", Property="mDefaultPowerPoleRecipe")
----

You will have to switch to:

[source,ini]
----
[AccessTransformers]
BlueprintReadWrite=(Class="/Script/FactoryGame.FGWireHologram", Property="mDefaultPowerPoleRecipe")
----

If you don't update your access transformers messages will be generated in your output log explaining what needs to be changed, for example, `LogAccessTransformers: Warning: Resolving BlueprintReadWrite AFGRecipeManager:mAvailableRecipes requested by MAMTips: Using deprecated class specification. The loaded class was /Script/FactoryGame.FGRecipeManager. Please update your AccessTransformers config file. This will become an error in a future version.`

This change was made as part of a move away from using ANY_PACKAGE,
which you can read more about in the Unreal documentation if you are interested.

=== {cpp} Mod Module Build.cs Changes

When generating visual studio project files for your project, you may encounter an error similar to the below:

// cspell:ignore projectfiles
```
Running C:/Program Files/Unreal Engine - CSS U8/Engine/Build/BatchFiles/Build.bat  -projectfiles -project="C:/Git/SatisfactoryModLoader/FactoryGame.uproject" -game -rocket -progress -log="C:\Git\SatisfactoryModLoader/Saved/Logs/UnrealVersionSelector-2023.07.08-13.29.57.log"
Running UnrealBuildTool: dotnet "..\..\Engine\Binaries\DotNET\UnrealBuildTool\UnrealBuildTool.dll" -projectfiles -project="C:/Git/SatisfactoryModLoader/FactoryGame.uproject" -game -rocket -progress -log="C:\Git\SatisfactoryModLoader/Saved/Logs/UnrealVersionSelector-2023.07.08-13.29.57.log"
Log file: C:\Git\SatisfactoryModLoader\Saved\Logs\UnrealVersionSelector-2023.07.08-13.29.57.log
Log file: C:\Users\Rob\AppData\Local\UnrealBuildTool\Log_GPF.txt

Some Platforms were skipped due to invalid SDK setup: Linux, LinuxArm64.
See the log file for detailed information

Discovering modules, targets and source code for project...
C:\Git\SatisfactoryModLoader\Mods\MAMTips\Source\MAMTips\MAMTips.Build.cs(5,7): error CS0246: The type or namespace name 'Tools' could not be found (are you missing a using directive or an assembly reference?)
C:\Git\SatisfactoryModLoader\Mods\MAMTips\Source\MAMTips\MAMTips.Build.cs(13,32): error CS0246: The type or namespace name 'DirectoryReference' could not be found (are you missing a using directive or an assembly reference?)
C:\Git\SatisfactoryModLoader\Mods\MAMTips\Source\MAMTips\MAMTips.Build.cs(14,64): error CS0246: The type or namespace name 'DirectoryReference' could not be found (are you missing a using directive or an assembly reference?)
Expecting to find a type to be declared in a target rules named 'FactoryEditorTarget'.  This type must derive from the 'TargetRules' type defined by Unreal Build Tool.
```

Unreal Engine 5 includes updates to UBT to make it more extensible.
As part of these updates, certain libraries have moved to other names or paths.
For example, `Tools` has been replaced with `EpicGames.Core`.
You may have to modify or add additional `using` directives to your mod module's Build.cs file.
In the case of this example error message, adding the following directives resolved the issue.

[source,cs]
----
using System;
using System.Runtime.InteropServices;
using System.Text;
using EpicGames.Core;
----

You may also need to remove or change some dependencies from the target list, such as PhysX because they no longer exist.
Try using the example Build.cs from the xref:Development/Cpp/setup.adoc#_creating_the_mod_module_from_scratch[C++ Setup page] if you're encountering issues.

== Additional Changes

You might not be affected by these changes,
but we'd like to draw extra attention to them.

=== Default Button Style Change

UE5 seems to default the Appearance of buttons to Draw As: Rounded Box.
You may need to change them back to Draw As: Image (the previous default)
in order to get the same look as they did before.

image:https://cdn.discordapp.com/attachments/1036634533077979146/1128346194012282971/image.png[D4rk screenshot of changing button Draw As]

=== Online Subsystem Changes

Changes to the Unreal Engine Online Subsystem have made it impossible to
launch the game with a fixed username from the command line.
This affects the launch scripts provided in the
xref:Development/TestingResources.adoc#LaunchScript[Testing/Multiplayer Testing] page.
Although this functionality has not returned at the time of writing,
the page has been updated with an improved version of the launch script.

We're looking for help resolving this - if you'd like to help,
please contact us on the Discord and read
https://github.com/satisfactorymodding/SatisfactoryModLoader/issues/182[this issue].

=== IsLocationNearABase Deprecation

According to Ben from Coffee Stain,
`AFGProximitySubsystem::IsNearBase` should be used instead of `IsLocationNearABase`.

=== ANY_PACKAGE Deprecation

If you are using features that look up classes or objects with ANY_PACKAGE filters,
note that this has been deprecated in UE5.1.

Some alternatives include specifying the full class path or using the safe variants of the functions.
More info can be found
https://forums.unrealengine.com/t/findobject-withough-any-package/742812/3[here].

=== Rider users: Mods no longer detected and uproject model no longer supported

The structure of the project has changed and Rider can no longer auto discover mod targets
if you're using the `.uproject` model.
Furthermore, using the `.uproject` model will cause Rider to try and build the Engine, which files are not present for, corrupting the Rider project.
The `.sln` model should still work as it did before.

== Notable New Features

Numerous new features have been introduced in SML3.5 which you may wish to switch your mod over to using
or implement as part of a future update to your mod.

=== Research Tree Editor

Have you been holding off on implementing a MAM research tree in your mod because of how tedious it is?
Wait no more!

The new Research Tree Editor allows you to create and edit research trees in a visual interface
and provides basic error checking functionality.

To launch the tool, navigate to the `SMLEditor Content/ResearchTree/` folder in the Content Browser,
right click on the `ResearchTreeHelper` asset, then select `Run Editor Utility Widget`.
Hover over elements in the tool to see tooltips explaining what they do.

The Example Mod has been updated with a complex research tree (created by the tool)
to demonstrate and explain some important research tree concepts.
Explore this tree, and the base game's trees, to learn more about how research trees work.

=== Sort Array Node

SMLEditor now provides a custom Blueprint node for sorting arrays
that does so in a much more performant way than a sorting algorithm implemented in Blueprint.
Provide an array of any type and create a function to be used as a comparator.
The comparator should return `true` if item A is less than item B.

=== ExampleMod Multiplayer Examples

ExampleMod has been updated to include some examples of correctly adding multiplayer functionality to your mod.
The xref:Development/Satisfactory/Multiplayer.adoc[Multiplayer]
page has also been updated with more information and tutorials.

=== Session Settings

Session Settings are a feature similar to the base game's Advanced Game Settings that allows mods to store configuration information on a per-game-save basis.

Read more about it on the
xref:Development/ModLoader/SessionSettings.adoc[Session Settings] page.

=== Widget Blueprint Hooks

Widget Blueprint Hooks can be used to add your custom widget into one of the existing game widgets.
If you've previously been using `Bind on BPFunction` 'Construct', this system may be a better fit for you.

Read more about it on the
xref:Development/ModLoader/WidgetBlueprintHooks.adoc[Widget Blueprint Hooks] page.

See the Example Mod and SML itself for examples of how to use this system.

=== Simple Construction Script Hooks

Blueprint Simple Construction Script hooks allow adding modded
https://docs.unrealengine.com/5.1/en-US/components-in-unreal-engine/[Components]
to any blueprint-based actor.

Read more about it on the
xref:Development/ModLoader/SimpleConstructionScript.adoc[Simple Construction Script (SCS) Hooks] page.

See the Example Mod for examples of how to use this system.

=== New Debugging Capabilities

There are two new launch flags to assist with debugging {cpp} mods.
You can read more about them on the
xref:Development/Cpp/debugging.adoc#_launch_Arguments[Debugging] page.

=== Mod Localization

We have started hosting our own Tolgee instance
that makes it easy to crowdsource and contribute translations to the modding toolkit and to mods.

Read more about how you can get started on the
xref:Development/Localization.adoc[Localizing Mods] page.

=== Custom Level Support

This feature has not yet been documented in detail, however,
the Example Mod has been updated with its own custom level that
properly registers itself through the Custom Level system and demonstrates many custom level concepts.

=== Exploration Sink Points Registration

You can now provide a data table for registering items for the Resource Sink to be put on the Exploration track.
The only base-game item on that track is the Alien DNA Capsule.
See the Example Mod for an example of how to use this system.
